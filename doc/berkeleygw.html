<!DOCTYPE HTML>
<html>
	<head>
		<title>Fanhao Jia</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
        <link rel="stylesheet" href="../assets/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../assets/css/katex.min.css" />
		<script src="../assets/js/katex.min.js"></script>
		<script src="../assets/js/auto-render.js"></script>	
		<script type="text/x-mathjax-config">  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!--<script id="MathJax-script" async src="../assets/js/tex-mml-chtml.js"></script>-->
		<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
    </head>
  
<body>
    <nav >
        <div class="container"> 
            <div class="navbar-collapse" id="navbar">
                <ul class="nav navbar-nav">
                    <li >
                        <a href="https://fanhaojia.github.io/#note"><b>主页Home</b></a>
                    </li>
                </ul>
            </div>
        </div>			
    </nav>
	
<main id="main">
    <div class="content inner">
				<header class="page-header">
					<center><h2 class="page-title">&nbsp; Berkeley GW编译</h2></center>
				</header>
				
<section class="wrapper style1 align-left">
<div class="inner">

<div class="language-plaintext highlighter-rouge">
<div class="highlight">
<h2><b>上海超算魔方3环境变量</b></h2>
<pre class="highlight"><code>
source /public/software/profile.d/compiler_intel-compiler-2017.5.239.sh
source /public/software/profile.d/mpi_intelmpi-2017.4.239.sh
</code></pre>
</div></div>

<h2><b>FFTW编译</b></h2>
<div class="language-plaintext highlighter-rouge">
<div class="highlight">
<pre class="highlight"><code>
source /public/software/profile.d/mpi_intelmpi-2017.4.239.sh
source /public/software/profile.d/compiler_intel-compiler-2017.5.239.sh
wget http://www.fftw.org/fftw-3.3.8.tar.gz
tar -zxvf fftw-3.3.8.tar.gz
cd fftw-3.3.8
编译双精度版本
./configure --prefix=/public/home/users/shu001/software/fftw-3.3.8 CC=icc F77=ifort MPICC=mpiicc --enable-shared --enable-static --enable-mpi --enable-threads --enable-avx --enable-avx2 --enable-openmp
make -j 8 
make install
编译单精度版本
./configure --prefix=/public/home/users/shu001/software/fftw-3.3.8 CC=icc F77=ifort MPICC=mpiicc --enable-float --enable-sse --enable-shared --enable-static --enable-mpi --enable-threads --enable-avx --enable-avx2 --enable-openmp
make -j 8 
make install
</code></pre>
</div></div>


<div class="language-plaintext highlighter-rouge">
<div class="highlight">
<h2><b>Install hdf5</b></h2>
<pre class="highlight"><code>
tar zxvf hdf5-1.10.5.tar.gz
cd hdf5-1.10.5 
./configure --prefix=/public/home/users/shu001/software/hdf5-1.10.5 CC=mpiicc FC=mpiifort CXX=mpiicpc --enable-fortran --enable-parallel --enable-shared
make
make install
</code></pre>
</div></div>

<div class="language-plaintext highlighter-rouge">
<div class="highlight">
<h2><b>Install Berkeley GW</b></h2>
<pre class="highlight"><code>
tar -zxvf BerkeleyGW-2.1.tar.gz
cd BerkeleyGW-2.1 
export MKLROOT=/public/software//compiler/intel/intel-compiler-2017.5.239/mkl
cp config/babbage.nersc.gov.mk arch.mk #根据你的系统环境调整，下面是我的系统上的configure
vi arch.mk
"
COMPFLAG  = -DINTEL
PARAFLAG  = -DMPI
MATHFLAG  = -DUSESCALAPACK -DHDF5 -DUNPACKED -DUSEFFTW3
FCPP    = /usr/bin/cpp -ansi -ffreestanding
F90free = mpiifort -free
#LINK    = mpiifort -i-static -openmp
#LINK    = mpiifort -qopenmp
LINK    = mpiifort
FOPTS   = -O3
FNOOPTS = $(FOPTS)
MOD_OPT = -module
INCFLAG = -I
C_PARAFLAG = -DPARA -DMPICH_IGNORE_CXX_SEEK
CC_COMP = mpiicpc
C_COMP  = mpiicc
C_LINK  = mpiicpc
C_OPTS  = -O3
C_DEBUGFLAG =
REMOVE  = /bin/rm -f

FFTWPATH     = /public/home/users/shu001/software/fftw-3.3.8
FFTWLIB      = $(FFTWPATH)/lib/libfftw3.a
FFTWINCLUDE  = $(FFTWPATH)/include

#MKLROOT      = /public/home/users/app/compiler/intel-2019.4/compilers_and_libraries_2019.4.243/linux/mkl
MKLROOT      = /public/software//compiler/intel/intel-compiler-2017.5.239/mkl
MKLPATH      = $(MKLROOT)/lib/intel64
LAPACKLIB    = -Wl,--start-group $(MKLPATH)/libmkl_intel_lp64.a $(MKLPATH)/libmkl_sequential.a \
               $(MKLPATH)/libmkl_core.a $(MKLPATH)/libmkl_blacs_intelmpi_lp64.a \
               -Wl,--end-group -lpthread
SCALAPACKLIB = $(MKLPATH)/libmkl_scalapack_lp64.a

HDF5DIR      = /public/home/users/shu001/software/hdf5-1.10.5
HDF5LIB      = $(HDF5DIR)/lib/libhdf5hl_fortran.a $(HDF5DIR)/lib/libhdf5_hl.a \
               $(HDF5DIR)/lib/libhdf5_fortran.a $(HDF5DIR)/lib/libhdf5.a -lz
HDF5INCLUDE  = $(HDF5DIR)/include
#TESTSCRIPT = sbatch hbar.scr
TESTSCRIPT = make check-parallel
"
make all-flavors

</code></pre>
</div></div>



</div>

</div></section>
</div>
</main>
			<script src="../assets/js/jquery-3.3.1.slim.min.js"></script>
			<script src="../assets/js/popper.min.js"></script>
			<script src="../assets/js/bootstrap.min.js"></script>
			<script src="../assets/js/jquery.min.js"></script>
			<script src="../assets/js/jquery.scrollex.min.js"></script>
			<script src="../assets/js/jquery.scrolly.min.js"></script>
			<script src="../assets/js/browser.min.js"></script>
			<script src="../assets/js/breakpoints.min.js"></script>
			<script src="../assets/js/util.js"></script>
			<script src="../assets/js/main.js"></script>

	</body>
</html>

